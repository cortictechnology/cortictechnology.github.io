<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creating a New Service</title>
    <link rel="stylesheet" href="cortic_styles.css">
    <link rel="stylesheet" href="dracula.css" />
    <script src="https://unpkg.com/@highlightjs/cdn-assets@11.7.0/highlight.min.js"></script>
    <!-- and it's easy to individually load additional languages -->
    <script src="https://unpkg.com/@highlightjs/cdn-assets@11.7.0/languages/javascript.min.js"></script>
    </script>
</head>

<body>

    <h1>Creating Your Service</h1>
    <p>This guide aims to instruct developers on creating a new service by subclassing from the base "Service" class
        available in the Cortic Platform SDK.</p>

    <h2>1. Create a New Service</h2>
    <ol>
        <li>Click the "Add Service" button in the Service panel of an App of your choice.</li>
        <li>Follow the prompts to name and configure your service's initial settings. Note that the
            Programming Handle is the name of the service invoking function that you can use in your code.</li>
        <li>Click "Add" to create the service.</li>
        <li>If you have finished setting up the VSCode path, you can press the "Edit Service" button to
            open the service's source code in VSCode.</li>
    </ol>

    <h2>2. Service Class Overview</h2>
    <p>For effective integration into the Cortic Platform, it is crucial for your service to implement three core
        methods:</p>
    <ul>
        <li><code>activate</code>
            <ul>
                <li>This method is called when the service is activated. It is responsible for initializing the service
                    and loading any required resources.</li>
            </ul>
        </li>
        <li><code>process</code>
            <ul>
                <li>This method is called when the service is invoked. It is responsible for processing the input and
                    returning the output.</li>
            </ul>
        </li>
        <li><code>deactivate</code>
            <ul>
                <li>This method is called when the service is deactivated. It is responsible for cleaning up any
                    resources and shutting down the service.</li>
            </ul>
        </li>
    </ul>

    <div class="screenshot-placeholder">&lt;screenshot&gt;</div>

    <h2>3. Platform Independent Services</h2>
    <p>Developing a service that remains independent of the underlying platform provides flexibility and broadens
        compatibility. There are three primary methods to achieve this:</p>

    <h3>1. Using Main Processor for Computations</h3>
    <p>By focusing on the main processor for all computations, you eschew the need for specialized hardware. This
        ensures a generic compatibility across platforms. The downside is that the performance may be suboptimal.</p>

    <h3>2. Leveraging Python Packages</h3>
    <p>Python packages such as PyTorch can support multiple backends. By utilizing such a package, you can abstract away
        the specifics of the backend and ensure your service works seamlessly across various platforms.</p>

    <h3>3. Conditional Requirements in <code>environment.yml</code></h3>
    <p>Edit the pip requirements section of <code>environment.yml</code> to add conditional requirements specific to
        each platform. This allows
        you to specify the requirements for each platform and ensure that only the relevant requirements are installed.
        In addition to this, you also need to detect the current platform within your
        service's running code to execute the relevant tasks.</p>

    <h2>3. Sample Service: Face Detection</h2>
    <p>To better understand the creation of a generic service, let's examine a face detection service for each of the
        scenarios mentioned above:</p>

    <h3>1. Main Processor-Based Face Detection</h3>
    <p>To illustrate the use of the main processor for computations, we will use Google's MediaPipe Face Detection
        package. This package is compatible with both the CPU and GPU, and we will use the CPU version for this
        example.</p>

    <h3>2. PyTorch Backend-Based Face Detection</h3>
    <p>To illustrate the use of a Python package that supports multiple backends, we will create a service based on the
        BlazeFace project by <a href="https://github.com/hollance/BlazeFace-PyTorch" target="_blank">hollance</a>. This
        project uses PyTorch as the underlying framework and supports multiple backends, including CPU, GPU, and Apple's
        MPS.
    </p>
    <h3>3. Conditional Requirements-Based Face Detection</h3>
    <p>To illustrate the use of conditional requirements, we will create a service that uses Google's MediaPipe Face
        Detection package for Linux and Windows, but uses a CoreML Blazeface model for macOS. This means that the
        we will need to add the following lines to the pip requirements section of the <code>environment.yml</code>
        file:</p>
    <pre><code class="language-python">mediapipe; sys_platform == "linux" or sys_platform == "win32"
coremltools; sys_platform == "darwin"
</code></pre>
    <p> The <code>environment.yml</code> file should now look like this:</p>
    <pre><code class="language-python">name: cortic-face-detection
channels:
    - defaults
    - anaconda
    - conda-forge
dependencies:
    - python=3.9
    - pip
    - pip:
        - numpy
        - opencv-python
        - mediapipe; sys_platform == "linux" or sys_platform == "win32"
        - coremltools; sys_platform == "darwin"
</code></pre>
    <p>Then, we will need to detect the current platform within the service's running code to execute the relevant
        tasks. This can be done using the <code>platform</code> module:</p>
    <pre><code class="language-python">import platform

if platform.system() == "Darwin":
    # macOS
    # Use CoreML Blazeface model
else:
    # Linux or Windows
    # Use MediaPipe Face Detection package
</code></pre>

    <p> The entire code for the face detection service is shown below:</p>

    <h3>4. Deploying the Face Detection Service</h3>
    <p>Once you have finished creating the service, you can deploy it to your devices by following the steps
        below:</p>
    <ol>
        <li>Click the "Deploy" button in the Service panel of the App of your choice.</li>
        <li>Once the service has been deployed, you can see the service's status in the Device page.</li>
    </ol>

    <h2>Next Steps</h2>
    <p>Now that you have successfully created a service:</p>
    <ul>
        <li>Consider optimizing the service for better performance.</li>
        <li>Explore the Cortic Platform SDK to create more advanced services.</li>
        <li>Explore integrating additional functionalities to enhance the service capabilities.</li>
        <li>Look into the advanced features of the Cortic Platform SDK for more sophisticated implementations.</li>
    </ul>

</body>

</html>